# reservation
API (Node.js + PostgreSQL) для тестового задания по бронированию номеров.
## Развертывание

### Установка
* Установить [Node.js Latest LTS](https://nodejs.org/en/download).
* Установить [PostgreSQL](https://www.postgresql.org/download/).
* Установить [Postman](https://www.postman.com/).

### Клонирование репозитория

    git clone https://github.com/theBang/reservation.git
    cd reservation

### Установка зависимостей

    npm install

### Подготовка БД
* Создать пользователя приложения из `db/dump/role.sql`. При необходимости изменить пароль.
* Создать БД из `db/dump/database.sql`.
* Следующие шаги могут быть пропущены, если далее запускать скрипт с миграцией:
    * Создать таблицы из `db/dump/tables.sql`. 
    * Добавить данные в таблицы `db/dump/data.sql`. 

### Настройка переменных окружения
* Скопировать `.env.example` в `.env`
* Изменить пароль пользователя приложения (`PGPASSWORD`), если он был изменен в шаге подготовки БД.

## Состав приложения
* `index.js` - Express сервер.
* `check-user.js` - Mock внешнего API для проверки VIP клиентов.
* `db/index.js` - модуль взаимодействия с БД.

## Запуск приложения

При запуске через npm скрипты одновременно поднимаются Express сервер и Mock внешнего API.

Запуск без миграции БД, если она была выполнена в шаге подготовки БД:

    npm run start

Запуск с миграцией БД

    npm run start:migrate

## Тестирование

* Импортировать `test_api.postman_collection.json`.
* Поочередно запустить запросы с проверкой ответов.

В коллекции запросов для тестирования имеются следующие папки запросов для проверки работоспособности API:

* All rooms - запрос всех номеров.
* Free rooms - запросы наличия свободных номеров по датам.
    * Подпапка Validation - проверка корректности тела запроса.
* Reserve - запросы бронивания.
    * Подпапка Validation - проверка корректности тела запроса.
* Remove reservation - запросы удаления бронирования.
    * Подпапка Validation - проверка корректности запроса.




